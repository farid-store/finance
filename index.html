<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ledger Pro: Snowball Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        background: 'var(--bg-main)',
                        surface: 'var(--card-bg)',
                        primary: '#6366f1', // Indigo 500
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(99, 102, 241, 0.3)'
                    }
                }
            }
        }
    </script>
    <style>
        /* --- PREMIUM VARIABLES --- */
        :root { 
            --bg-main: #f8fafc; 
            --text-main: #0f172a; 
            --card-bg: #ffffff; 
            --sidebar-bg: rgba(255, 255, 255, 0.8);
            --input-bg: #f1f5f9;
        }

        .dark-mode { 
            --bg-main: #09090b; /* Zinc 950 */
            --text-main: #f4f4f5; 
            --card-bg: #18181b; /* Zinc 900 */
            --sidebar-bg: rgba(24, 24, 27, 0.8);
            --input-bg: #27272a;
        }

        body { 
            background-color: var(--bg-main); 
            color: var(--text-main); 
            font-family: 'Inter', sans-serif; 
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        /* --- GLASSMORPHISM & UTILS --- */
        .glass {
            background: var(--sidebar-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-right: 1px solid rgba(0,0,0,0.05);
        }
        .dark-mode .glass { border-right: 1px solid rgba(255,255,255,0.05); }

        /* Modern Scrollbar (Hidden but functional) */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark-mode ::-webkit-scrollbar-thumb { background: #3f3f46; }

        /* --- COMPONENTS --- */
        .card-pro {
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(0,0,0,0.03);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .dark-mode .card-pro { border: 1px solid rgba(255,255,255,0.05); box-shadow: none; }
        
        /* Input Field: The "Apple" Style (No border, grey bg) */
        .input-clean {
            background: var(--input-bg);
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            width: 100%;
            outline: none;
            font-size: 0.9rem;
            color: var(--text-main);
            transition: box-shadow 0.2s;
        }
        .input-clean:focus { box-shadow: 0 0 0 2px var(--primary); }

        /* Status Pills */
        .status-pill { padding: 4px 10px; border-radius: 99px; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
        
        /* Layout Fixes */
        .hidden-panel { display: none; }
        .mode-desktop { max-width: 1000px; margin: 0 auto; border-left: 1px solid rgba(0,0,0,0.05); border-right: 1px solid rgba(0,0,0,0.05); min-height: 100vh; background: var(--card-bg); }

        /* Calculator Specifics */
        .calc-btn { width: 100%; height: 45px; border-radius: 12px; font-weight: 600; font-size: 14px; transition: 0.1s; display: grid; place-items: center; }
        .calc-btn:active { transform: scale(0.95); }
    </style>
</head>
<body class="pb-32">

    <div id="overlay" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden z-40 transition-opacity" onclick="toggleSidebar()"></div>

    <aside id="sidebar" class="glass fixed top-0 left-0 h-full w-72 z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-out flex flex-col">
        <div class="p-8 pb-4">
            <h1 class="text-2xl font-black tracking-tighter italic flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-indigo-500 animate-pulse"></span>
                SNOWBALL
            </h1>
            <p class="text-xs text-gray-400 font-medium ml-5 mt-1">Financial Freedom Tracker</p>
        </div>

        <nav class="flex-1 px-4 space-y-2 overflow-y-auto mt-4">
            <div onclick="switchPage('main')" class="p-3 rounded-xl cursor-pointer hover:bg-gray-100 dark:hover:bg-white/5 transition flex items-center gap-3 text-sm font-semibold text-gray-600 dark:text-gray-300">
                <span>üìä</span> Dashboard
            </div>
            
            <div class="p-3">
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">Tools</div>
                <div onclick="toggleDropdown('dropCheck')" class="flex justify-between items-center cursor-pointer text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-indigo-500 transition">
                    <span>Gadget Check</span>
                    <span class="text-xs">‚ñº</span>
                </div>
                <div id="dropCheck" class="hidden pl-2 mt-2 space-y-2 border-l-2 border-gray-100 dark:border-gray-800 ml-1">
                    <div onclick="switchPage('hp')" class="cursor-pointer text-xs text-gray-500 hover:text-indigo-500 pl-3 py-1">Handphone</div>
                    <div onclick="switchPage('dial')" class="cursor-pointer text-xs text-gray-500 hover:text-indigo-500 pl-3 py-1">Dial Codes</div>
                    <div onclick="switchPage('laptop')" class="cursor-pointer text-xs text-gray-500 hover:text-indigo-500 pl-3 py-1">Laptop</div>
                </div>
            </div>

            <div onclick="toggleCutLossModal()" class="p-3 rounded-xl cursor-pointer bg-rose-50 dark:bg-rose-900/10 text-rose-600 dark:text-rose-400 flex items-center gap-3 text-sm font-bold transition hover:bg-rose-100">
                <span>‚úÇÔ∏è</span> Cut Loss Calc
            </div>

            <div class="mt-4 bg-gray-100 dark:bg-white/5 p-4 rounded-2xl">
                <div class="text-right mb-2">
                    <div id="calc-prev" class="text-[10px] text-gray-400 h-4"></div>
                    <div id="calc-curr" class="text-xl font-mono font-bold">0</div>
                </div>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="calcClear()" class="calc-btn bg-rose-100 text-rose-600">C</button>
                    <button onclick="calcDel()" class="calc-btn bg-gray-200 dark:bg-white/10">‚Üê</button>
                    <button onclick="calcPerc()" class="calc-btn bg-gray-200 dark:bg-white/10">%</button>
                    <button onclick="calcOp('/')" class="calc-btn bg-indigo-100 text-indigo-600">√∑</button>
                    
                    <button onclick="calcNum('7')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">7</button>
                    <button onclick="calcNum('8')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">8</button>
                    <button onclick="calcNum('9')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">9</button>
                    <button onclick="calcOp('*')" class="calc-btn bg-indigo-100 text-indigo-600">√ó</button>

                    <button onclick="calcNum('4')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">4</button>
                    <button onclick="calcNum('5')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">5</button>
                    <button onclick="calcNum('6')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">6</button>
                    <button onclick="calcOp('-')" class="calc-btn bg-indigo-100 text-indigo-600">-</button>

                    <button onclick="calcNum('1')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">1</button>
                    <button onclick="calcNum('2')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">2</button>
                    <button onclick="calcNum('3')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">3</button>
                    <button onclick="calcOp('+')" class="calc-btn bg-indigo-100 text-indigo-600">+</button>
                    
                    <button onclick="calcNum('0')" class="calc-btn bg-white dark:bg-white/5 shadow-sm col-span-2">0</button>
                    <button onclick="calcNum('.')" class="calc-btn bg-white dark:bg-white/5 shadow-sm">.</button>
                    <button onclick="calcResult()" class="calc-btn bg-indigo-500 text-white shadow-glow">=</button>
                </div>
            </div>
        </nav>

        <div class="p-4 border-t border-gray-100 dark:border-white/5">
            <div class="flex gap-2 mb-2">
                <button onclick="exportJSON()" class="flex-1 py-2 rounded-lg bg-gray-200 dark:bg-white/10 text-[10px] font-bold text-gray-600 dark:text-gray-400">BACKUP</button>
                <button onclick="document.getElementById('jsonInput').click()" class="flex-1 py-2 rounded-lg bg-gray-200 dark:bg-white/10 text-[10px] font-bold text-gray-600 dark:text-gray-400">RESTORE</button>
                <input type="file" id="jsonInput" hidden onchange="importJSON(this)">
            </div>
            <button onclick="toggleDarkMode()" class="w-full py-2 rounded-lg border border-gray-200 dark:border-gray-700 text-xs font-medium flex justify-center items-center gap-2">
                <span id="darkModeIcon">üåô</span> <span id="darkModeText">Switch Theme</span>
            </button>
        </div>
    </aside>

    <main id="page-main" class="transition-all duration-300 lg:ml-72 p-6 max-w-6xl mx-auto">
        
        <div class="lg:hidden flex justify-between items-center mb-6">
            <button onclick="toggleSidebar()" class="p-2 bg-white dark:bg-white/10 rounded-xl shadow-sm">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <h1 class="font-black italic text-lg tracking-tighter">SNOWBALL</h1>
        </div>

        <div class="flex justify-end gap-3 mb-6" id="admin-top-actions">
            <button onclick="toggleImportModal()" class="px-4 py-2 rounded-full text-xs font-bold bg-white dark:bg-white/5 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:shadow-md transition">
                üì• Import Text
            </button>
            <button onclick="exportReport()" class="px-4 py-2 rounded-full text-xs font-bold bg-indigo-600 text-white shadow-glow hover:bg-indigo-500 transition">
                üìã Copy Report
            </button>
        </div>

        <div class="admin-only-view card-pro relative overflow-hidden bg-gradient-to-br from-indigo-600 to-violet-700 text-white p-8 mb-8 border-none">
            <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl -translate-y-10 translate-x-10"></div>
            
            <div class="relative z-10 flex flex-col md:flex-row justify-between items-end gap-6">
                <div>
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xs font-bold uppercase tracking-widest bg-white/20 px-2 py-1 rounded">Level <span id="currentLevel">1</span></span>
                        <span class="text-xs font-medium opacity-80">Next: <span id="nextLevelTarget">50 Juta</span></span>
                    </div>
                    <div class="w-full bg-black/20 h-2 rounded-full overflow-hidden w-48 md:w-64">
                        <div id="levelBar" class="h-full bg-white shadow-[0_0_10px_white] transition-all duration-1000" style="width: 0%"></div>
                    </div>
                    <p id="motivationText" class="text-xs font-medium mt-2 italic opacity-90">Keep pushing!</p>
                </div>
                <div class="text-right">
                    <p class="text-[10px] uppercase font-bold opacity-70 mb-1">Total Net Worth</p>
                    <h2 id="totalAssetDisplay" class="text-3xl md:text-4xl font-black tracking-tight">Rp 0</h2>
                </div>
            </div>
        </div>

        <div class="admin-only-view grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
            <div class="card-pro p-5">
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-2">Modal Tunai</p>
                <h3 id="summaryCash" class="text-xl font-bold text-gray-800 dark:text-gray-100">Rp 0</h3>
            </div>
            <div class="card-pro p-5">
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-2">Aset Barang</p>
                <h3 id="summaryStock" class="text-xl font-bold text-gray-800 dark:text-gray-100">Rp 0</h3>
            </div>
            <div class="card-pro p-5 md:col-span-1 col-span-2 bg-gradient-to-br from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 border-emerald-100 dark:border-none">
                <p class="text-[10px] text-emerald-600/70 font-bold uppercase tracking-wider mb-2">Total Profit</p>
                <h3 id="summaryProfit" class="text-xl font-bold text-emerald-600 dark:text-emerald-400">Rp 0</h3>
            </div>
        </div>

        <div class="admin-only-view card-pro p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-sm">Input Unit Baru</h3>
                <div class="flex items-center gap-2 bg-gray-100 dark:bg-white/5 rounded-lg px-2 py-1">
                    <span class="text-[9px] font-bold text-gray-400">DATE:</span>
                    <input type="date" id="backdateInput" class="bg-transparent border-none text-xs font-bold text-gray-600 dark:text-gray-300 outline-none p-0">
                </div>
            </div>
            <textarea id="bulkInput" class="input-clean font-mono text-xs mb-4 min-h-[80px]" placeholder="Format: Nama HP : Modal > Jual&#10;Contoh: iPhone 11 : 4000000 > 4500000"></textarea>
            <div class="flex gap-3">
                <button onclick="parseText('old')" class="flex-1 py-3 rounded-xl bg-gray-100 dark:bg-white/10 text-xs font-bold text-gray-600 dark:text-gray-300 hover:bg-gray-200 transition">Stok Lama</button>
                <button onclick="parseText('new')" class="flex-1 py-3 rounded-xl bg-gray-900 dark:bg-white text-white dark:text-black text-xs font-bold hover:shadow-lg transition">Belanja Baru</button>
            </div>
        </div>

        <div class="admin-only-view mb-8 space-y-4">
            <div class="flex gap-4">
                <button onclick="document.getElementById('configPanel').classList.toggle('hidden-panel')" class="text-xs font-bold text-gray-400 hover:text-indigo-500 transition flex items-center gap-1">‚öôÔ∏è Set Modal Awal</button>
                <button onclick="document.getElementById('extraProfitPanel').classList.toggle('hidden-panel')" class="text-xs font-bold text-gray-400 hover:text-emerald-500 transition flex items-center gap-1">üìà Profit Manual</button>
            </div>
            
            <div id="configPanel" class="hidden-panel card-pro p-4 bg-gray-50 dark:bg-white/5">
                <label class="text-[10px] font-bold uppercase text-gray-400 mb-1 block">Saldo Awal Bulan</label>
                <input type="number" id="startBalance" class="input-clean font-bold text-indigo-600" value="0" onchange="calculateAll()">
            </div>

            <div id="extraProfitPanel" class="hidden-panel card-pro p-4 bg-emerald-50/50 dark:bg-emerald-900/10">
                <textarea id="exBulkInput" class="input-clean bg-white dark:bg-black/20 h-16 mb-2 font-mono text-xs" placeholder="Nama : Modal > Jual"></textarea>
                <button onclick="parseExtraProfitText()" class="w-full py-2 bg-emerald-500 text-white rounded-lg text-xs font-bold shadow-sm">Simpan</button>
                <div id="extraProfitList" class="mt-3 space-y-1"></div>
            </div>
        </div>

        <div class="sticky top-0 z-30 pt-2 pb-4 bg-opacity-80 backdrop-blur-xl -mx-4 px-4 bg-[var(--bg-main)]">
            <div class="relative mb-3">
                <input type="text" id="searchInput" onkeyup="renderRows()" placeholder="Cari nama unit..." class="input-clean pl-10 shadow-sm bg-white dark:bg-white/5">
                <span class="absolute left-3 top-3 text-gray-400">üîç</span>
            </div>
            <div class="flex p-1 bg-gray-200/50 dark:bg-white/5 rounded-xl">
                <button onclick="setFilter('stok')" id="tabStok" class="flex-1 py-2 rounded-lg text-xs font-bold shadow-sm bg-white dark:bg-gray-800 text-indigo-600 transition-all">Stok Aktif</button>
                <button onclick="setFilter('sold')" id="tabSold" class="flex-1 py-2 rounded-lg text-xs font-bold text-gray-500 hover:text-gray-700 transition-all">Terjual</button>
                <button onclick="setFilter('extra')" id="tabExtra" class="flex-1 py-2 rounded-lg text-xs font-bold text-gray-500 hover:text-gray-700 transition-all">History</button>
            </div>
        </div>

        <div id="itemRows" class="space-y-3 pb-24 grid grid-cols-1 md:grid-cols-2 gap-4"></div>

        <div class="fixed bottom-0 left-0 lg:left-72 right-0 p-4 bg-white/80 dark:bg-black/80 backdrop-blur-md border-t border-gray-100 dark:border-white/5 flex justify-between items-center text-[10px] font-bold text-gray-400 uppercase tracking-widest">
            <div class="flex gap-2">
                <button onclick="setAccessMode('admin')" id="btnAccessAdmin" class="text-indigo-500">ADMIN</button>
                <span>/</span>
                <button onclick="setAccessMode('client')" id="btnAccessClient" class="hover:text-indigo-500">CLIENT</button>
            </div>
            <div class="flex gap-2">
                <button onclick="setView('mobile')" id="btnMob" class="hover:text-indigo-500">Mobile</button>
                <span>/</span>
                <button onclick="setView('desktop')" id="btnDesk" class="hover:text-indigo-500">Desktop</button>
            </div>
        </div>
    </main>

    <div id="page-hp" class="hidden lg:ml-72 p-8 min-h-screen bg-[var(--bg-main)]">
        <button onclick="switchPage('main')" class="mb-8 text-xs font-bold text-gray-400 hover:text-indigo-500 flex items-center gap-1">‚Üê BACK TO DASHBOARD</button>
        <h1 class="text-3xl font-black mb-6">Device Check</h1>
        <div class="card-pro p-6 max-w-xl">
            <div class="flex gap-2 mb-6">
                <input type="number" id="imeiInput" class="input-clean" placeholder="Paste IMEI here...">
                <button onclick="directImei()" class="px-6 rounded-xl bg-black dark:bg-white text-white dark:text-black font-bold text-xs">CHECK</button>
            </div>
            <div class="grid gap-3">
                <button onclick="window.open('https://old.beacukai.go.id/websitenewV2/cek-imei.html')" class="p-4 rounded-xl bg-gray-50 dark:bg-white/5 hover:bg-gray-100 text-left text-sm font-bold flex justify-between">Cek Beacukai <span>‚Üó</span></button>
                <button onclick="window.open('https://sickw.com/')" class="p-4 rounded-xl bg-gray-50 dark:bg-white/5 hover:bg-gray-100 text-left text-sm font-bold flex justify-between">SICKSW (Detailed Info) <span>‚Üó</span></button>
                <button onclick="window.open('https://www.touchscreentest.com/')" class="p-4 rounded-xl bg-gray-50 dark:bg-white/5 hover:bg-gray-100 text-left text-sm font-bold flex justify-between">Touchscreen Test <span>‚Üó</span></button>
            </div>
        </div>
    </div>

    <div id="page-dial" class="hidden lg:ml-72 p-8 min-h-screen">
        <button onclick="switchPage('main')" class="mb-8 text-xs font-bold text-gray-400 hover:text-indigo-500">‚Üê BACK</button>
        <h1 class="text-3xl font-black mb-6">Secret Codes</h1>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="card-pro p-6 hover:-translate-y-1"><h3 class="text-xs font-bold text-gray-400 mb-2">SAMSUNG</h3><p class="text-2xl font-mono font-bold">*#0*#</p></div>
            <div class="card-pro p-6 hover:-translate-y-1"><h3 class="text-xs font-bold text-gray-400 mb-2">XIAOMI</h3><p class="text-2xl font-mono font-bold">*#*#64663#*#*</p></div>
            <div class="card-pro p-6 hover:-translate-y-1"><h3 class="text-xs font-bold text-gray-400 mb-2">OPPO/REALME</h3><p class="text-2xl font-mono font-bold">*#899#</p></div>
            <div class="card-pro p-6 hover:-translate-y-1"><h3 class="text-xs font-bold text-gray-400 mb-2">VIVO</h3><p class="text-2xl font-mono font-bold">*#558#</p></div>
            <div class="card-pro p-6 hover:-translate-y-1"><h3 class="text-xs font-bold text-gray-400 mb-2">IPHONE</h3><p class="text-2xl font-mono font-bold">*3001#12345#*</p></div>
            <div class="card-pro p-6 hover:-translate-y-1"><h3 class="text-xs font-bold text-gray-400 mb-2">Check IMEI</h3><p class="text-2xl font-mono font-bold">*#06#</p></div>
        </div>
    </div>

    <div id="page-laptop" class="hidden lg:ml-72 p-8 min-h-screen">
        <button onclick="switchPage('main')" class="mb-8 text-xs font-bold text-gray-400 hover:text-indigo-500">‚Üê BACK</button>
        <h1 class="text-3xl font-black mb-6">Laptop QC</h1>
        <div class="grid md:grid-cols-3 gap-4">
            <div class="card-pro p-6">
                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold mb-4">1</div>
                <h3 class="font-bold mb-2">Physical</h3>
                <ul class="text-sm text-gray-500 space-y-2"><li>‚Ä¢ Hinge Check</li><li>‚Ä¢ Dead Pixel</li><li>‚Ä¢ White Spot</li></ul>
            </div>
            <div class="card-pro p-6">
                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold mb-4">2</div>
                <h3 class="font-bold mb-2">Performance</h3>
                <ul class="text-sm text-gray-500 space-y-2"><li>‚Ä¢ Battery Health</li><li>‚Ä¢ SSD Sentinel</li><li>‚Ä¢ Keyboard All Keys</li></ul>
            </div>
            <div class="card-pro p-6">
                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold mb-4">3</div>
                <h3 class="font-bold mb-2">Features</h3>
                <ul class="text-sm text-gray-500 space-y-2"><li>‚Ä¢ Ports (USB/HDMI)</li><li>‚Ä¢ Webcam & Mic</li><li>‚Ä¢ Speakers</li></ul>
            </div>
        </div>
    </div>

    <div id="editModal" class="fixed inset-0 z-[60] flex items-center justify-center hidden p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeEditModal()"></div>
        <div class="relative card-pro w-full max-w-sm p-6 bg-[var(--card-bg)] shadow-2xl scale-100 transition-transform">
            <h3 class="text-lg font-bold mb-4">Edit Item</h3>
            <input type="hidden" id="editId">
            <div class="space-y-3">
                <input type="text" id="editName" class="input-clean font-bold" placeholder="Nama Unit">
                <div class="grid grid-cols-2 gap-3">
                    <input type="number" id="editModalPrice" class="input-clean" placeholder="Modal">
                    <input type="number" id="editSellPrice" class="input-clean" placeholder="Jual">
                </div>
                <input type="text" id="editNotes" class="input-clean" placeholder="Catatan/Minus">
                <input type="date" id="editDateIn" class="input-clean">
                <div id="buyerField" class="hidden">
                    <input type="text" id="editBuyer" class="input-clean bg-emerald-50 dark:bg-emerald-900/10 text-emerald-700" placeholder="Nama Pembeli">
                </div>
                <button onclick="saveEdit()" class="w-full py-3 rounded-xl bg-black dark:bg-white text-white dark:text-black font-bold shadow-lg hover:scale-[1.02] transition">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="cutLossModal" class="fixed inset-0 z-[60] flex items-center justify-center hidden p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="toggleCutLossModal()"></div>
        <div class="relative card-pro w-full max-w-sm p-6 bg-[var(--card-bg)]">
            <h3 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="text-rose-500">‚úÇÔ∏è</span> Cut Loss Calculator</h3>
            <div class="space-y-4 mb-6">
                <div class="p-3 bg-rose-50 dark:bg-rose-900/10 rounded-xl">
                    <p class="text-[10px] font-bold text-rose-500 uppercase mb-2">Item Mandek (Lama)</p>
                    <input type="number" id="clModalA" placeholder="Modal Awal" class="input-clean mb-2 bg-white dark:bg-black/20">
                    <input type="number" id="clJualA" placeholder="Jual Rugi brp?" class="input-clean bg-white dark:bg-black/20">
                </div>
                <div class="p-3 bg-emerald-50 dark:bg-emerald-900/10 rounded-xl">
                    <p class="text-[10px] font-bold text-emerald-500 uppercase mb-2">Item Pengganti (Baru)</p>
                    <input type="number" id="clModalB" placeholder="Modal Baru" class="input-clean mb-2 bg-white dark:bg-black/20">
                    <input type="number" id="clJualB" placeholder="Potensi Jual" class="input-clean bg-white dark:bg-black/20">
                </div>
            </div>
            <div class="text-center mb-4">
                <h2 id="clResult" class="text-2xl font-black">Rp 0</h2>
                <p id="clAdvice" class="text-xs font-bold text-gray-400 mt-1">...</p>
            </div>
            <button onclick="calcCutLoss()" class="w-full py-3 rounded-xl bg-gray-900 dark:bg-white text-white dark:text-black font-bold">Calculate</button>
        </div>
    </div>

    <div id="importModal" class="fixed inset-0 z-[60] flex items-center justify-center hidden p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="toggleImportModal()"></div>
        <div class="relative card-pro w-full max-w-md p-6 bg-[var(--card-bg)]">
            <h3 class="text-lg font-bold mb-4">Bulk Import</h3>
            <textarea id="importArea" class="input-clean h-48 mb-4 font-mono text-xs" placeholder="Paste WhatsApp report here..."></textarea>
            <button onclick="processImport()" class="w-full py-3 rounded-xl bg-indigo-600 text-white font-bold shadow-glow">Process Data</button>
        </div>
    </div>

    <script>
        // --- LOGIC SCRIPT (SAME AS BEFORE, PRESERVED) ---
        let items = [];
        let extraProfits = [];
        let currentFilter = 'stok';
        let accessMode = 'admin';
        const LEVELS = [50000000, 100000000, 250000000, 500000000, 1000000000];

        window.onload = () => { 
            loadData(); 
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
            updateThemeIcon();
        };

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('darkModeIcon').innerText = isDark ? "‚òÄÔ∏è" : "üåô";
            document.getElementById('darkModeText').innerText = isDark ? "Light Mode" : "Dark Mode";
        }

        function toggleSidebar() { 
            document.getElementById('sidebar').classList.toggle('-translate-x-full'); 
            document.getElementById('overlay').classList.toggle('hidden'); 
            document.getElementById('overlay').classList.toggle('opacity-0'); 
        }
        function toggleDropdown(id) { 
            const el = document.getElementById(id);
            el.classList.toggle('hidden');
        }
        function switchPage(page) {
            ['page-main', 'page-hp', 'page-laptop', 'page-dial'].forEach(p => document.getElementById(p)?.classList.add('hidden'));
            document.getElementById('page-' + page)?.classList.remove('hidden');
            if(window.innerWidth < 1024) document.getElementById('sidebar').classList.add('-translate-x-full'); 
            document.getElementById('overlay').classList.add('hidden');
            window.scrollTo(0,0);
        }
        
        function setAccessMode(mode) {
            accessMode = mode;
            const btnA = document.getElementById('btnAccessAdmin');
            const btnC = document.getElementById('btnAccessClient');
            const adminOnly = document.querySelectorAll('.admin-only-view');

            if(mode === 'admin') {
                btnA.classList.add('text-indigo-500'); btnC.classList.remove('text-indigo-500');
                document.getElementById('admin-top-actions').style.display = 'flex';
                adminOnly.forEach(el => el.style.display = 'block');
                document.getElementById('itemRows').classList.add('md:grid-cols-2');
            } else {
                btnC.classList.add('text-indigo-500'); btnA.classList.remove('text-indigo-500');
                document.getElementById('admin-top-actions').style.display = 'none';
                adminOnly.forEach(el => el.style.display = 'none');
                document.getElementById('itemRows').classList.remove('md:grid-cols-2');
            }
            renderRows();
        }

        function setView(mode) {
            const body = document.body;
            if(mode === 'desktop') {
                body.classList.add('mode-desktop');
                document.getElementById('btnDesk').classList.add('text-indigo-500');
                document.getElementById('btnMob').classList.remove('text-indigo-500');
            } else {
                body.classList.remove('mode-desktop');
                document.getElementById('btnMob').classList.add('text-indigo-500');
                document.getElementById('btnDesk').classList.remove('text-indigo-500');
            }
        }

        function calculateAll() {
            const start = Number(document.getElementById('startBalance').value) || 0;
            let cashUsed = 0, cashIn = 0, totalStockValue = 0, profitRealized = 0;
            
            items.forEach(i => {
                if (i.status === 'sold') {
                    if (i.type === 'new') cashUsed += i.modal;
                    cashIn += i.price;
                    profitRealized += (i.price - i.modal);
                } else {
                    if (i.type === 'new') cashUsed += i.modal;
                    totalStockValue += i.modal;
                }
            });

            const extraProfitTotal = extraProfits.reduce((sum, p) => sum + p.profit, 0);
            profitRealized += extraProfitTotal;
            const currentCash = start - cashUsed + cashIn + extraProfitTotal;
            const totalAsset = currentCash + totalStockValue;

            document.getElementById('summaryCash').innerText = formatRupiah(currentCash);
            document.getElementById('summaryStock').innerText = formatRupiah(totalStockValue);
            document.getElementById('totalAssetDisplay').innerText = formatRupiah(totalAsset);
            document.getElementById('summaryProfit').innerText = formatRupiah(profitRealized);

            let currentLevel = 1;
            let nextTarget = LEVELS[0];
            for (let i = 0; i < LEVELS.length; i++) {
                if (totalAsset >= LEVELS[i]) {
                    currentLevel = i + 2;
                    nextTarget = LEVELS[i+1] || LEVELS[i] * 2;
                } else { nextTarget = LEVELS[i]; break; }
            }
            
            let prevTarget = currentLevel === 1 ? 0 : LEVELS[currentLevel-2];
            let progress = ((totalAsset - prevTarget) / (nextTarget - prevTarget)) * 100;
            if (progress > 100) progress = 100; if (progress < 0) progress = 0;

            document.getElementById('currentLevel').innerText = currentLevel;
            document.getElementById('nextLevelTarget').innerText = (nextTarget / 1000000) + " Juta";
            document.getElementById('levelBar').style.width = progress + "%";
            document.getElementById('motivationText').innerText = progress > 80 ? "üî• Almost there! Push it!" : "‚ùÑÔ∏è Keep Snowballing.";
            
            renderRows();
            renderExtraProfitList();
            saveData();
        }

        function renderRows() {
            const container = document.getElementById('itemRows');
            const search = document.getElementById('searchInput').value.toLowerCase();
            const now = new Date();
            let display = [];
            
            if(currentFilter === 'extra') {
                 container.innerHTML = '';
                 extraProfits.filter(p => p.name.toLowerCase().includes(search)).forEach(p => {
                    const div = document.createElement('div');
                    div.className = "card-pro p-4 flex justify-between items-center bg-gray-50 dark:bg-white/5 border-none";
                    div.innerHTML = `<div><span class="status-pill bg-gray-200 text-gray-600 mb-1 inline-block">HISTORY</span><h4 class="font-bold text-sm">${p.name}</h4><p class="text-xs text-emerald-500 font-bold">+ ${formatNum(p.profit)}</p></div><button onclick="removeExtraProfit(${p.id})" class="text-gray-300 hover:text-rose-500 px-2">‚úï</button>`;
                    container.appendChild(div);
                 });
                 return;
            } else {
                display = items.filter(i => i.status === currentFilter && i.name.toLowerCase().includes(search));
                if(currentFilter === 'stok') display.sort((a, b) => new Date(a.dateObj || a.entryDate) - new Date(b.dateObj || b.entryDate));
                else display.sort((a, b) => new Date(b.soldDateObj || b.soldAt) - new Date(a.soldDateObj || a.soldAt));
            }

            container.innerHTML = '';
            
            display.forEach(item => {
                const entryDate = new Date(item.dateObj || now); 
                const ageInDays = Math.floor((now - entryDate) / (1000 * 60 * 60 * 24));
                const profit = item.price - item.modal;
                
                let ageColor = "text-gray-400";
                if(item.status === 'stok' && ageInDays > 30) ageColor = "text-rose-500 font-bold";
                else if(item.status === 'stok' && ageInDays > 14) ageColor = "text-amber-500 font-bold";

                if(accessMode === 'admin') {
                    const div = document.createElement('div');
                    div.className = `card-pro p-5 relative group border-none ${item.status === 'sold' ? 'opacity-80' : ''}`;
                    div.innerHTML = `
                        <div class="flex justify-between items-start cursor-pointer" onclick="openEditModal(${item.id})">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="status-pill ${item.type === 'new' ? 'bg-indigo-100 text-indigo-700' : 'bg-orange-100 text-orange-700'}">${item.type === 'new' ? 'NEW' : 'USED'}</span>
                                    ${item.status === 'stok' ? `<span class="text-[10px] ${ageColor}">${ageInDays} days</span>` : '<span class="status-pill bg-emerald-100 text-emerald-700">SOLD</span>'}
                                </div>
                                <h4 class="font-bold text-gray-800 dark:text-white mb-1 leading-tight">${item.name}</h4>
                                <div class="flex items-center gap-3 text-xs font-mono text-gray-500">
                                    <span>M:${formatNum(item.modal)}</span>
                                    <span class="text-gray-300">‚ûú</span>
                                    <span class="${item.status==='stok'?'text-indigo-600 font-bold':''}">${formatNum(item.price)}</span>
                                </div>
                                ${item.notes ? `<p class="text-[10px] text-amber-600 mt-2 bg-amber-50 dark:bg-amber-900/20 inline-block px-2 py-1 rounded">üìù ${item.notes}</p>` : ''}
                                ${item.buyer ? `<p class="text-[10px] text-emerald-600 font-bold mt-1">üë§ ${item.buyer}</p>` : ''}
                            </div>
                            <div class="flex flex-col items-end gap-2" onclick="event.stopPropagation()">
                                ${item.status === 'stok' 
                                    ? `<button onclick="markSold(${item.id})" class="px-3 py-1.5 rounded-lg bg-emerald-500 text-white text-[10px] font-bold shadow hover:bg-emerald-600">SOLD</button>` 
                                    : `<span class="text-xs font-bold ${profit >= 0 ? 'text-emerald-500' : 'text-rose-500'}">${profit >= 0 ? '+' : ''}${formatNum(profit)}</span>`
                                }
                                <button onclick="deleteItem(${item.id})" class="text-gray-300 hover:text-rose-500 p-1 opacity-0 group-hover:opacity-100 transition">‚úï</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                } else {
                    // CLIENT VIEW
                    const card = document.createElement('div');
                    card.className = "card-pro p-6 flex justify-between items-center";
                    card.innerHTML = `
                        <div>
                            <h4 class="font-bold text-lg text-gray-800 dark:text-white mb-1">${item.name}</h4>
                            <div class="flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full ${item.status === 'sold' ? 'bg-rose-500' : 'bg-emerald-500'}"></span>
                                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">${item.status === 'sold' ? 'SOLD OUT' : 'AVAILABLE'}</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-bold text-indigo-500 uppercase">PRICE</p>
                            <div class="text-xl font-black text-gray-800 dark:text-white">Rp ${item.price.toLocaleString('id-ID')}</div>
                        </div>`;
                    container.appendChild(card);
                }
            });
        }

        // --- STANDARD FUNCTIONS (Identical to previous logic) ---
        function parseText(type) {
            const rawText = document.getElementById('bulkInput').value;
            const customDate = document.getElementById('backdateInput').value;
            if (!rawText.trim()) return;
            let entryTime = customDate ? new Date(customDate) : new Date();
            if(customDate) entryTime.setHours(12, 0, 0, 0);

            rawText.split('\n').forEach(line => {
                const parts = line.split(/[:>]/);
                if (parts.length >= 3) {
                    const name = parts[0].trim().replace(/^-\s*/, '').replace(/\[[BL]\]\s*/, '');
                    const modal = Number(parts[1].replace(/[^0-9]/g, ''));
                    const price = Number(parts[2].replace(/[^0-9]/g, ''));
                    if (name && modal) {
                        items.push({ id: Date.now() + Math.random(), name, modal, price, status: 'stok', type, dateObj: entryTime.toISOString(), entryDate: formatDate(entryTime), notes: '', buyer: '' });
                    }
                }
            });
            document.getElementById('bulkInput').value = '';
            calculateAll();
        }

        function markSold(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                const buyer = prompt("Nama Pembeli:", "") || "";
                item.status = 'sold'; item.soldDateObj = new Date().toISOString(); item.soldAt = formatDate(new Date()); item.buyer = buyer;
                const invoice = `*INVOICE*\nUnit: ${item.name}\nHarga: ${formatRupiah(item.price)}\n\nTerima kasih Kak ${buyer}!`;
                if(confirm("Kirim Nota WA?")) window.open(`https://wa.me/?text=${encodeURIComponent(invoice)}`, '_blank');
                calculateAll();
            }
        }
        function deleteItem(id) { if(confirm('Hapus permanen?')) { items = items.filter(i => i.id !== id); calculateAll(); } }
        function parseExtraProfitText() {
            const rawText = document.getElementById('exBulkInput').value;
            if (!rawText.trim()) return;
            rawText.split('\n').forEach(line => {
                const parts = line.split(/[:>]/);
                if(parts.length >= 3) {
                    const name = parts[0].trim(); const modal = Number(parts[1].replace(/[^0-9]/g, '')); const price = Number(parts[2].replace(/[^0-9]/g, ''));
                    if (name && modal && price) extraProfits.push({ id: Date.now() + Math.random(), name, modal, price, profit: price - modal });
                }
            });
            document.getElementById('exBulkInput').value = ''; calculateAll();
        }
        function removeExtraProfit(id) { extraProfits = extraProfits.filter(p => p.id !== id); calculateAll(); }
        function renderExtraProfitList() {
            const list = document.getElementById('extraProfitList'); list.innerHTML = '';
            extraProfits.forEach(p => {
                const div = document.createElement('div'); div.className = "flex justify-between text-xs text-gray-500 border-b border-gray-100 dark:border-white/5 py-1";
                div.innerHTML = `<span>${p.name} (+${formatNum(p.profit)})</span><button onclick="removeExtraProfit(${p.id})" class="text-rose-500">x</button>`;
                list.appendChild(div);
            });
        }
        function openEditModal(id) {
            if(accessMode !== 'admin') return;
            const item = items.find(i => i.id === id); if(!item) return;
            document.getElementById('editId').value = id; document.getElementById('editName').value = item.name; document.getElementById('editModalPrice').value = item.modal; document.getElementById('editSellPrice').value = item.price; document.getElementById('editNotes').value = item.notes || ''; document.getElementById('editBuyer').value = item.buyer || '';
            const d = new Date(item.dateObj || item.entryDate); if(!isNaN(d)) document.getElementById('editDateIn').value = d.toISOString().split('T')[0];
            if(item.status === 'sold') document.getElementById('buyerField').classList.remove('hidden'); else document.getElementById('buyerField').classList.add('hidden');
            document.getElementById('editModal').classList.remove('hidden');
        }
        function saveEdit() {
            const id = parseFloat(document.getElementById('editId').value); const item = items.find(i => i.id === id);
            if(item) {
                item.name = document.getElementById('editName').value; item.modal = Number(document.getElementById('editModalPrice').value); item.price = Number(document.getElementById('editSellPrice').value); item.notes = document.getElementById('editNotes').value; item.buyer = document.getElementById('editBuyer').value;
                const newDateStr = document.getElementById('editDateIn').value;
                if(newDateStr) { const d = new Date(newDateStr); d.setHours(12,0,0); item.dateObj = d.toISOString(); item.entryDate = formatDate(d); }
                closeEditModal(); calculateAll();
            }
        }
        function closeEditModal() { document.getElementById('editModal').classList.add('hidden'); }
        function toggleCutLossModal() { document.getElementById('cutLossModal').classList.toggle('hidden'); }
        function calcCutLoss() {
            const mA = Number(document.getElementById('clModalA').value)||0; const jA = Number(document.getElementById('clJualA').value)||0; const mB = Number(document.getElementById('clModalB').value)||0; const jB = Number(document.getElementById('clJualB').value)||0;
            const net = (jA - mA) + (jB - mB);
            const resEl = document.getElementById('clResult'); const advEl = document.getElementById('clAdvice');
            resEl.innerText = formatRupiah(net);
            if (net > 0) { resEl.className = "text-2xl font-black text-emerald-500"; advEl.innerText = "‚úÖ EXECUTE! PROFITABLE."; } 
            else { resEl.className = "text-2xl font-black text-rose-500"; advEl.innerText = "‚ùå HOLD! LOSS."; }
        }
        function exportJSON() {
            const dataStr = JSON.stringify({ startBalance: document.getElementById('startBalance').value, items, extraProfits }, null, 2);
            const blob = new Blob([dataStr], {type: "application/json"}); const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `Snowball_Backup.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }
        function importJSON(input) {
            const file = input.files[0]; if(!file) return; const reader = new FileReader();
            reader.onload = function(e) { try { const data = JSON.parse(e.target.result); if(confirm(`Restore?`)) { items = data.items || []; extraProfits = data.extraProfits || []; document.getElementById('startBalance').value = data.startBalance || 0; calculateAll(); } } catch(err) { alert("Error!"); } };
            reader.readAsText(file);
        }
        function toggleImportModal() { document.getElementById('importModal').classList.toggle('hidden'); }
        function processImport() {
            const text = document.getElementById('importArea').value; if(!text) return; const lines = text.split('\n');
            lines.forEach(l => { if(l.includes('[B]') || l.includes('[L]')) { const type = l.includes('[B]') ? 'new' : 'old'; const clean = l.replace(/‚úÖ|üì¶|-|\[B\]|\[L\]/g, '').trim(); const parts = clean.split(/[:>]/); if(parts.length >= 2) items.push({ id: Date.now()+Math.random(), name: parts[0].trim(), modal: 0, price: 0, status: 'stok', type, dateObj: new Date().toISOString(), entryDate: formatDate(new Date()) }); } });
            toggleImportModal(); calculateAll();
        }
        function exportReport() {
            let report = `*SNOWBALL REPORT*\nDate: ${formatDate(new Date())}\n\n*ASSETS*\nCash: ${document.getElementById('summaryCash').innerText}\nStock: ${document.getElementById('summaryStock').innerText}\nNET WORTH: ${document.getElementById('totalAssetDisplay').innerText}\n----------------\n*SOLD ITEMS*\n`;
            items.filter(i => i.status === 'sold').forEach(i => { report += `‚úÖ ${i.name} (Cuan: ${formatNum(i.price - i.modal)})\n`; });
            report += `\n*STOCK*\n`; items.filter(i => i.status === 'stok').forEach(i => { report += `üì¶ ${i.name}\n`; });
            navigator.clipboard.writeText(report).then(() => alert("Copied!"));
        }
        function saveData() { localStorage.setItem('ledger_v3_snowball', JSON.stringify({ startBalance: document.getElementById('startBalance').value, items, extraProfits })); }
        function loadData() {
            let data = JSON.parse(localStorage.getItem('ledger_v3_snowball')); if (!data) data = JSON.parse(localStorage.getItem('ledger_v2_final'));
            if (data) { document.getElementById('startBalance').value = data.startBalance || 0; items = data.items || []; extraProfits = data.extraProfits || []; items.forEach(i => { if(!i.dateObj) i.dateObj = new Date().toISOString(); }); calculateAll(); }
        }
        function formatRupiah(num) { return "Rp " + num.toLocaleString('id-ID'); }
        function formatNum(num) { return num.toLocaleString('id-ID'); }
        function formatDate(date) { const d = new Date(date); return `${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`; }
        function setFilter(f) { 
            currentFilter = f; 
            const buttons = { 'stok': 'tabStok', 'sold': 'tabSold', 'extra': 'tabExtra' };
            for(const key in buttons) { const el = document.getElementById(buttons[key]); if(key === f) { el.classList.remove('text-gray-500'); el.classList.add('bg-white', 'dark:bg-gray-800', 'text-indigo-600', 'shadow-sm'); } else { el.classList.add('text-gray-500'); el.classList.remove('bg-white', 'dark:bg-gray-800', 'text-indigo-600', 'shadow-sm'); } }
            renderRows(); 
        }
        function directImei() { window.open('https://www.imei.info/?imei=' + document.getElementById('imeiInput').value, '_blank'); }
        
        // Calc Logic (Mini)
        let cInput = '0', cPrev = '', cOp = null;
        function calcNum(n) { if (n === '.' && cInput.includes('.')) return; cInput = (cInput === '0' && n !== '.') ? n : cInput + n; calcUpd(); }
        function calcOp(op) { if (cInput === '') return; if (cPrev !== '') calcResult(); cOp = op; cPrev = cInput; cInput = ''; calcUpd(); }
        function calcResult() { let res; const p = parseFloat(cPrev), c = parseFloat(cInput); if (isNaN(p) || isNaN(c)) return; switch (cOp) { case '+': res = p + c; break; case '-': res = p - c; break; case '*': res = p * c; break; case '/': res = p / c; break; } cInput = parseFloat(res.toFixed(10)).toString(); cOp = null; cPrev = ''; calcUpd(); }
        function calcClear() { cInput = '0'; cPrev = ''; cOp = null; calcUpd(); }
        function calcDel() { cInput = cInput.toString().slice(0, -1) || '0'; calcUpd(); }
        function calcPerc() { cInput = (parseFloat(cInput)/100).toString(); calcUpd(); }
        function calcUpd() { document.getElementById('calc-curr').innerText = parseFloat(cInput).toLocaleString('id-ID'); }
    </script>
</body>
</html>
