<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker Pro - Phone Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; overflow-x: hidden; }
        .card { border-radius: 16px; background: white; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .input-field { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #cbd5e1; outline: none; transition: 0.3s; }
        .input-field:focus { border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
        .btn-primary { color: white; padding: 12px; border-radius: 10px; font-weight: 600; width: 100%; transition: 0.2s; cursor: pointer; border: none; }
        .btn-primary:active { transform: scale(0.98); }
        .badge-profit { background: #dcfce7; color: #166534; padding: 4px 10px; border-radius: 8px; font-size: 0.75rem; font-weight: 700; border: 1px solid #bbf7d0; }
        .btn-sell { background: #10b981; color: white; padding: 6px 12px; border-radius: 8px; font-size: 0.7rem; font-weight: 700; transition: 0.2s; }
        #sidebar { transition: transform 0.3s ease; transform: translateX(-100%); z-index: 50; }
        #sidebar.open { transform: translateX(0); }
        #overlay, #hintModalOverlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 40; }
        #overlay.open, #hintModalOverlay.open { display: block; }
        .hidden-panel { display: none; }
    </style>
</head>

<body class="p-4 md:p-8">

<div class="max-w-2xl mx-auto">

    <!-- IMPORT -->
    <div class="card p-6 mb-4 border-dashed border-2 border-indigo-300">
        <h3 class="font-bold text-gray-800 mb-2 text-sm uppercase tracking-wider">üì• Import Laporan</h3>
        <textarea id="importInput" class="input-field h-32 mb-3 text-sm"
            placeholder="Paste laporan hasil export di sini..."></textarea>
        <button onclick="importReport()" class="btn-primary bg-indigo-600 text-[10px] uppercase">
            Import Laporan
        </button>
    </div>

    <!-- SMART INPUT -->
    <div class="card p-6 mb-4">
        <h3 class="font-bold text-gray-800 mb-2 text-sm uppercase tracking-wider">üìù Smart Input</h3>
        <textarea id="bulkInput" class="input-field h-24 mb-3 text-sm"
            placeholder="Nama : Modal > Jual"></textarea>
        <div class="grid grid-cols-2 gap-3">
            <button onclick="parseText('old')" class="btn-primary bg-slate-700 text-[10px] uppercase">Stok Lama</button>
            <button onclick="parseText('new')" class="btn-primary bg-emerald-600 text-[10px] uppercase">Stok Baru</button>
        </div>
    </div>

    <!-- SALDO -->
    <div class="card p-5 mb-4">
        <p class="text-[10px] text-gray-500 uppercase font-bold">Saldo Awal</p>
        <input type="number" id="startBalance" class="input-field font-black text-lg" value="0" onchange="calculateAll()">
    </div>

    <!-- SUMMARY -->
    <div class="grid grid-cols-2 gap-4 mb-6">
        <div class="card p-4">
            <p class="text-xs">Cash</p>
            <h2 id="summaryCash" class="font-black">Rp 0</h2>
        </div>
        <div class="card p-4">
            <p class="text-xs">Floating</p>
            <h2 id="summaryFloating" class="font-black">Rp 0</h2>
        </div>
        <div class="card p-4 col-span-2 bg-indigo-900 text-white text-center">
            <p class="text-xs">Total Aset</p>
            <h2 id="summaryTotal" class="text-2xl font-black">Rp 0</h2>
        </div>
    </div>

    <div id="itemRows" class="space-y-3"></div>
</div>

<script>
let items = [];

function parseText(type) {
    const raw = document.getElementById('bulkInput').value.split('\n');
    raw.forEach(line => {
        if (line.includes(':') && line.includes('>')) {
            const p = line.split(/[:>]/);
            items.push({
                id: Date.now() + Math.random(),
                name: p[0].trim(),
                modal: Number(p[1].replace(/\D/g,'')),
                price: Number(p[2].replace(/\D/g,'')),
                status: 'stok',
                type
            });
        }
    });
    document.getElementById('bulkInput').value = '';
    renderRows(); calculateAll();
}

function toggleSold(id){
    const i = items.find(x=>x.id===id);
    if(i){ i.status='sold'; renderRows(); calculateAll(); }
}

function renderRows(){
    const c = document.getElementById('itemRows');
    c.innerHTML='';
    items.forEach(i=>{
        const d=document.createElement('div');
        d.className='card p-4 flex justify-between';
        d.innerHTML=`
        <div>
            <b>${i.name}</b><br>
            <small>${i.modal.toLocaleString()} ‚Üí ${i.price.toLocaleString()}</small>
        </div>
        <div>
            ${i.status==='stok'
            ? `<button onclick="toggleSold(${i.id})" class="btn-sell">Laku?</button>`
            : `<span class="badge-profit">+${(i.price-i.modal).toLocaleString()}</span>`}
        </div>`;
        c.appendChild(d);
    });
}

function calculateAll(){
    const start = Number(startBalance.value)||0;
    let beli=0, masuk=0, floating=0;

    items.forEach(i=>{
        if(i.type==='new') beli+=i.modal;
        if(i.status==='sold') masuk+=i.price;
        else floating+=i.price;
    });

    summaryCash.innerText='Rp '+(start-beli+masuk).toLocaleString();
    summaryFloating.innerText='Rp '+floating.toLocaleString();
    summaryTotal.innerText='Rp '+(start-beli+masuk+floating).toLocaleString();
    saveData();
}

function importReport(){
    const t=document.getElementById('importInput').value;
    if(!t.trim()) return alert('Paste laporan dulu');
    if(!confirm('Data lama akan diganti. Lanjutkan?')) return;

    items=[];
    let mode='';
    t.split('\n').forEach(l=>{
        l=l.trim();
        if(l.includes('Report Bulanan')) mode='sold';
        if(l.includes('Unit Belum Terjual')) mode='stok';

        if(l.startsWith('-') && mode==='sold'){
            const m=l.match(/- (.+?) : ([\d.]+) > ([\d.]+)/);
            if(m) items.push({
                id:Date.now()+Math.random(),
                name:m[1], modal:+m[2].replace(/\./g,''), price:+m[3].replace(/\./g,''),
                status:'sold', type:'old'
            });
        }

        if(l.startsWith('-') && mode==='stok'){
            const m=l.match(/- (.+?) : ([\d.]+)/);
            if(m) items.push({
                id:Date.now()+Math.random(),
                name:m[1], modal:+m[2].replace(/\./g,''), price:+m[2].replace(/\./g,''),
                status:'stok', type:'old'
            });
        }

        if(l.includes('Saldo Awal')){
            startBalance.value=l.replace(/\D/g,'');
        }
    });

    document.getElementById('importInput').value='';
    renderRows(); calculateAll();
    alert('Import berhasil');
}

function saveData(){
    localStorage.setItem('ledger_import',JSON.stringify({items, start:startBalance.value}));
}

function loadData(){
    const d=JSON.parse(localStorage.getItem('ledger_import'));
    if(d){ items=d.items||[]; startBalance.value=d.start||0; renderRows(); calculateAll(); }
}
window.onload=loadData;
</script>

</body>
</html>
